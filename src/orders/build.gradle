plugins {
  id("com.github.johnrengelman.shadow") version "6.1.0"
  id("io.micronaut.application") version "1.4.5"
}

version = "1.0.0-SNAPSHOT"
group = "micronaut.mushop"

repositories {
  mavenCentral()
  maven { url "https://s01.oss.sonatype.org/content/repositories/snapshots/" }
}

micronaut {
  runtime("netty")
  testRuntime("junit5")
  processing {
    incremental(true)
    annotations("mushop.orders.*")
  }
}

dependencies {
  annotationProcessor("io.micronaut.openapi:micronaut-openapi")
  annotationProcessor("io.micronaut.data:micronaut-data-processor")
  implementation("javax.annotation:javax.annotation-api")
  implementation("io.micronaut:micronaut-validation")
  implementation("io.micronaut:micronaut-http-client")
  implementation("io.micronaut:micronaut-runtime")

  // Swagger
  implementation("io.swagger.core.v3:swagger-annotations")

  // Metrics
  implementation("io.micronaut:micronaut-management")
  implementation("io.micronaut.micrometer:micronaut-micrometer-core")
  implementation("io.micronaut.micrometer:micronaut-micrometer-registry-prometheus")
  runtime("io.micronaut.oraclecloud:micronaut-oraclecloud-micrometer:1.3.1-SNAPSHOT")

  // Tracing
  implementation("io.micronaut:micronaut-tracing")
  implementation("io.opentracing.brave:brave-opentracing")
  runtime("io.zipkin.brave:brave-instrumentation-http")
  runtime("io.zipkin.reporter2:zipkin-reporter")


  // ATP db access
  implementation platform("com.oracle.database.jdbc:ojdbc-bom:21.1.0.0")
  implementation("io.micronaut.oraclecloud:micronaut-oraclecloud-sdk")
  runtime("io.micronaut.oraclecloud:micronaut-oraclecloud-atp:1.3.1-SNAPSHOT")
  runtimeOnly("io.micronaut.sql:micronaut-jdbc-hikari")
  runtimeOnly("com.oracle.database.jdbc:ojdbc8")
  runtimeOnly("com.oracle.database.security:oraclepki:19.8.0.0")
  runtimeOnly("com.oracle.database.security:osdt_cert:19.8.0.0")
  runtimeOnly("com.oracle.database.security:osdt_core:19.8.0.0")
  implementation("io.micronaut.data:micronaut-data-hibernate-jpa")
  implementation("io.micronaut.data:micronaut-data-model")

  // Nats.io support
  implementation("io.micronaut.nats:micronaut-nats")

  runtimeOnly("ch.qos.logback:logback-classic")

  testImplementation("com.h2database:h2")
  testImplementation "org.mockito:mockito-core:3.+"
  testImplementation 'com.openpojo:openpojo:0.8.12'
  testImplementation("org.testcontainers:testcontainers")
  testImplementation "org.testcontainers:junit-jupiter"
}

application {
  mainClass.set("mushop.orders.OrderApplication")
}

java {
  sourceCompatibility = JavaVersion.toVersion("11")
  targetCompatibility = JavaVersion.toVersion("11")
}

dockerBuild {
  images = ["iad.ocir.io/cloudnative-devrel/micronaut-showcase/mushop/$project.name:$project.version"]
}

dockerBuildNative {
  images = ["iad.ocir.io/cloudnative-devrel/micronaut-showcase/mushop/${project.name}-native:$project.version"]
}


