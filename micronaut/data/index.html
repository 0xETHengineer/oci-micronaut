<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <title>Database Access :: Micronaut MuShop</title>
  
  <meta name="application-name" content="Micronaut MuShop"/>
<meta name="description" content="Oracle Cloud Native Workshop">
<meta name="keywords" content="Kubernetes,OCI,OKE,Microservices,Micronaut">

<meta property="og:title" content="Micronaut MuShop - Database Access" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/micronaut/data/" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../icons/favicon-16x16.png">
  <link rel="manifest" href="../../icons/site.webmanifest">
  <link rel="mask-icon" href="../../icons/safari-pinned-tab.svg" color="#41727e">
  <meta name="msapplication-TileColor" content="#c74634">
  <meta name="theme-color" content="#fcfbfa">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" type="text/css" href="../../sass/main.min.1cfa9655311242a0a659a59ecabdb240453b9a3299947792014d86ff1644a477.css" integrity="sha256-HPqWVTESQqCmWaWeyr2yQEU7mjKZlHeSAU2G/xZEpHc=">
  <link rel="stylesheet" type="text/css" href="../../fonts/fonts.min.58744946497c59fa8a6ac77636ea480457079e54512cf3dcb552592b56503cc1.css" integrity="sha256-WHRJRkl8WfqKasd2NupIBFcHnlRRLPPctVJZK1ZQPME=">
  <link rel="stylesheet" type="text/css" href="../../sass/mushop.min.c31ca585e7b3a90dfeb2fd0ac2d7d93ff0af82ea19b0cab20c8539d987761606.css" integrity="sha256-wxylheezqQ3&#43;sv0KwtfZP/CvguoZsMqyDIU52Yd2FgY=">
</head>

  <body class="" data-url="/micronaut/data/">
    
<div class="uk-navbar-container uk-hidden@s">
  <div class="">
    <nav role="navigation" class="uk-light uk-navbar" uk-navbar>
      <div class="uk-navbar-left">
        <a href="../../index.html" class="uk-navbar-item uk-logo">
          <img
            alt="Micronaut MuShop"
            class="uk-width-small"
            src="../../images/logo.dark.png">
        </a>
      </div>
      <div class="uk-navbar-right">
        <a class="uk-navbar-toggle" uk-navbar-toggle-icon uk-toggle="target: #navigation"></a>
      </div>
    </nav>
  </div>
</div>


<div class="uk-grid">
  
  
  <aside
    id="navigation"
    class="rw-sidebar uk-offcanvas uk-width-1-1 uk-width-1-3@s uk-width-1-4@m uk-width-1-5@l uk-width-1-6@xl uk-light uk-padding-remove"
    uk-offcanvas="overlay: true;">
    <div class="uk-offcanvas-bar uk-padding-small">
      
      
      <section>
        <div class="uk-margin-bottom uk-visible@s">
          <a href="../../index.html" class="uk-logo">
            <img src="../../images/logo.dark.png" alt="Micronaut MuShop">
          </a>
        </div>
        <div class="uk-margin-bottom">
          <form class="uk-search uk-search-default uk-width-expand">
  <span class="uk-search-icon-flip" uk-search-icon></span>
  <input id="search" class="uk-search-input uk-width-expand" type="search" placeholder="Search...">
</form>
<div id="search-results" class="uk-background-primary uk-text-small"></div>
        </div>
        <ul class="uk-nav uk-nav-primary" uk-nav="multiple: true; toggle: > a .uk-icon">
          <li class="uk-nav-divider"></li>
          
            


  
  
  
  <li data-nav-id="/introduction/" title="Introduction" class="">
    <a href="../../introduction/">
      <div class="uk-flex uk-flex-between uk-flex-middle">
        <div class="uk-text-truncate">Introduction</div>
      </div>
    </a>
    
    
  </li>
  

 

          
            


  
  
  
  <li data-nav-id="/quickstart/" title="Getting Started" class=" uk-parent">
    <a href="../../quickstart/">
      <div class="uk-flex uk-flex-between uk-flex-middle">
        <div class="uk-text-truncate">Getting Started</div><span class="uk-flex-none" uk-icon="icon: triangle-right; ratio: 1.5"></span>
      </div>
    </a>
    
    
    <ul class="uk-nav-sub">
      
      
      
      
      
        
        


  
    
    <li data-nav-id="/quickstart/dockecompose/" title="[Local] Docker compose" class="">
      <a href="../../quickstart/dockecompose/" class="uk-text-truncate">
        [Local] Docker compose
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/quickstart/terraform/" title="[Oracle Cloud] Terraform &#43; Helm" class="">
      <a href="../../quickstart/terraform/" class="uk-text-truncate">
        [Oracle Cloud] Terraform &#43; Helm
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/quickstart/helm/" title="[Oracle Cloud] Helm" class="">
      <a href="../../quickstart/helm/" class="uk-text-truncate">
        [Oracle Cloud] Helm
      </a>
    </li>
    
  

 

        
      
    </ul>
  
  </li>
  

 

          
            


  
  
  
  <li data-nav-id="/micronaut/" title="Micronaut Advantages" class=" uk-parent uk-open">
    <a href="../../micronaut/">
      <div class="uk-flex uk-flex-between uk-flex-middle">
        <div class="uk-text-truncate">Micronaut Advantages</div><span class="uk-flex-none" uk-icon="icon: triangle-right; ratio: 1.5"></span>
      </div>
    </a>
    
    
    <ul class="uk-nav-sub">
      
      
      
      
      
        
        


  
    
    <li data-nav-id="/micronaut/cloudnative/" title="Cloud Native Configuration" class="">
      <a href="../../micronaut/cloudnative/" class="uk-text-truncate">
        Cloud Native Configuration
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/service-discovery/" title="Service Discovery" class="">
      <a href="../../micronaut/service-discovery/" class="uk-text-truncate">
        Service Discovery
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/tracing/" title="Distributed Tracing" class="">
      <a href="../../micronaut/tracing/" class="uk-text-truncate">
        Distributed Tracing
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/management/" title="Health Checks &amp; Observability" class="">
      <a href="../../micronaut/management/" class="uk-text-truncate">
        Health Checks &amp; Observability
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/metrics/" title="Application Metrics and Monitoring" class="">
      <a href="../../micronaut/metrics/" class="uk-text-truncate">
        Application Metrics and Monitoring
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/atp/" title="Connecting Autonomous Database" class="">
      <a href="../../micronaut/atp/" class="uk-text-truncate">
        Connecting Autonomous Database
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/data/" title="Database Access" class="uk-active">
      <a href="../../micronaut/data/" class="uk-text-truncate">
        Database Access
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/openapi/" title="OpenAPI / Swagger" class="">
      <a href="../../micronaut/openapi/" class="uk-text-truncate">
        OpenAPI / Swagger
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/gateway/" title="Gateway Service" class="">
      <a href="../../micronaut/gateway/" class="uk-text-truncate">
        Gateway Service
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/security/" title="Security" class="">
      <a href="../../micronaut/security/" class="uk-text-truncate">
        Security
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/messaging/" title="Messaging" class="">
      <a href="../../micronaut/messaging/" class="uk-text-truncate">
        Messaging
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/httpclient/" title="HTTP Client" class="">
      <a href="../../micronaut/httpclient/" class="uk-text-truncate">
        HTTP Client
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/deployment/" title="Deployment" class="">
      <a href="../../micronaut/deployment/" class="uk-text-truncate">
        Deployment
      </a>
    </li>
    
  

 

        
      
        
        


  
    
    <li data-nav-id="/micronaut/native/" title="GraalVM Native Image" class="">
      <a href="../../micronaut/native/" class="uk-text-truncate">
        GraalVM Native Image
      </a>
    </li>
    
  

 

        
      
    </ul>
  
  </li>
  

 

          
          <li class="uk-nav-divider"></li>
        </ul>
      </section>
      
      <section>
        <ul class="uk-nav uk-nav-default" uk-nav>
          
          
          <li>
            <a title="More Information" href="../../resources" class="uk-text-truncate">
              <span uk-icon='icon: info; ratio: 1.25'></span>
              <span class="uk-text-middle">More Information</span>
              
            </a>
          </li>
          <li>
            <a title="Acknowledgements" href="../../acknowledgements" class="uk-text-truncate">
              <span uk-icon='icon: users; ratio: 1.25'></span>
              <span class="uk-text-middle">Acknowledgements</span>
              
            </a>
          </li>
          <li>
            <a title="Tags" href="../../tags" class="uk-text-truncate">
              <span uk-icon='icon: tag; ratio: 1.25'></span>
              <span class="uk-text-middle">Tags</span>
              
            </a>
          </li>
          <li>
            <a title="GitHub Source" href="https://github.com/oracle-quickstart/oci-micronaut" class="uk-text-truncate">
              <span uk-icon='icon: github; ratio: 1.25'></span>
              <span class="uk-text-middle">GitHub Source</span>
              
            </a>
          </li>
          <li>
            <a title="Report Issue" href="https://github.com/oracle-quickstart/oci-micronaut/issues" class="uk-text-truncate">
              <span uk-icon='icon: warning; ratio: 1.25'></span>
              <span class="uk-text-middle">Report Issue</span>
              
            </a>
          </li>
            <li>
              <a title='Edit this page' href="https://github.com/oracle-quickstart/oci-micronaut/tree/main/src/docs/contentmicronaut/data.md" target="blank">
                <span uk-icon="pencil"></span>
                <span class="uk-text-middle">Edit this page</span>
              </a>
            </li>
            
          
        </ul>
      </section>
      <section class="uk-margin-top">
        <hr>
        <ul id="rw-settings" class="uk-nav uk-nav-default" uk-nav>
  <li class="uk-grid uk-grid-small uk-flex-middle uk-flex-between uk-flex-nowrap uk-text-nowrap">
  <div class="uk-width-1-4">
    
    <span>Theme</span>
  </div>
  <div class="uk-button-group rw-setting"
    setting="theme"
    target="html, .content-container" ><button class="uk-button uk-button-small uk-button-secondary
    uk-active" toggle="uk-background-default" >
      Light
    </button><button class="uk-button uk-button-small uk-button-secondary
    " toggle="uk-light uk-background-secondary" >
      Dark
    </button></div>
</li>


  <li class="uk-grid uk-grid-small uk-flex-middle uk-flex-between uk-flex-nowrap uk-text-nowrap">
  <div class="uk-width-1-4">
    
    <span>OS</span>
  </div>
  <div class="uk-button-group rw-setting"
    setting="platform"
    target="html" ><button class="uk-button uk-button-small uk-button-secondary
    uk-active" toggle="stg-os-macos" >
      Mac
    </button><button class="uk-button uk-button-small uk-button-secondary
    " toggle="stg-os-linux" >
      Linux
    </button><button class="uk-button uk-button-small uk-button-secondary
    " toggle="stg-os-windows" >
      Windows
    </button></div>
</li>
</ul>



      </section>
      <section class="uk-text-small uk-text-lighter uk-margin-top">
        <hr>
        <div class="uk-text-muted">
  <div class="uk-margin-small">
    Made with <span uk-icon="icon: heart; ratio: 0.75"></span> by Oracle Developers
  </div>
  Copyright © 2021 Oracle and/or its affiliates. All rights reserved.
</div>
      </section>
    </div>
  </aside>
  
  <div class="uk-width-1-1 uk-width-1-3@s uk-width-1-4@m uk-width-1-5@l uk-width-1-6@xl uk-visible@s"></div>



    <div class="content-container uk-width-expand">
      <div class="uk-position-relative">
        <div id="content" class="uk-grid uk-container-xlarge" uk-grid>
          

<div class="uk-flex-last uk-width-1-4 uk-visible@l">
  <aside id="toc-nav" uk-sticky="offset: 40">
    <nav id="TableOfContents"></nav>
    <hr/>
    
  </aside>
</div>


          <main class="uk-width-expand">
            <header>
  
  </header>



            <h1 class="rw-accent">Database Access</h1>
              
  <p>The original MuShop application includes a lot of handwritten SQL logic that is greatly simplified by the use of <a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/">Micronaut Data</a>.</p>
<p>In the Go version of the following code, SQL is appended together manually and executed in order to perform a count:</p>
<div class="highlight"><pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">catalogueService</span><span class="p">)</span> <span class="nf">Count</span><span class="p">(</span><span class="nx">categories</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">query</span> <span class="o">:=</span> <span class="s">&#34;SELECT COUNT(DISTINCT products.sku) FROM products JOIN product_category ON products.sku=product_category.sku JOIN categories ON product_category.category_id=categories.category_id&#34;</span>

	<span class="kd">var</span> <span class="nx">args</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>

	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">t</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">categories</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
			<span class="nx">query</span> <span class="o">+=</span> <span class="s">&#34; WHERE categories.name=:categoryname&#34;</span>
			<span class="nx">args</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">query</span> <span class="o">+=</span> <span class="s">&#34; OR categories.name=:categoryname&#34;</span>
			<span class="nx">args</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="nx">sel</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nf">Prepare</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>

	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">&#34;database error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ErrDBConnection</span>
	<span class="p">}</span>
	<span class="k">defer</span> <span class="nx">sel</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>

	<span class="kd">var</span> <span class="nx">count</span> <span class="kt">int</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">sel</span><span class="p">.</span><span class="nf">QueryRow</span><span class="p">(</span><span class="nx">args</span><span class="o">...</span><span class="p">).</span><span class="nf">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>

	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">&#34;database error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ErrDBConnection</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">count</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

</code></pre></div><p>The above code is littered with error prone logic to produce the correct query and ensure database connetions are closed and error handling logic correctly applied.</p>
<p>The service logic still then needs to be wired into an exposed endpoing with <code>Go</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="nf">MakeEndpoints</span><span class="p">(</span><span class="nx">s</span> <span class="nx">Service</span><span class="p">,</span> <span class="nx">tracer</span> <span class="nx">stdopentracing</span><span class="p">.</span><span class="nx">Tracer</span><span class="p">)</span> <span class="nx">Endpoints</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">Endpoints</span><span class="p">{</span>
		<span class="nx">CountEndpoint</span><span class="p">:</span>      <span class="nx">opentracing</span><span class="p">.</span><span class="nf">TraceServer</span><span class="p">(</span><span class="nx">tracer</span><span class="p">,</span> <span class="s">&#34;GET /catalogue/size&#34;</span><span class="p">)(</span><span class="nf">MakeCountEndpoint</span><span class="p">(</span><span class="nx">s</span><span class="p">)),</span>
		<span class="o">...</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">MakeCountEndpoint</span><span class="p">(</span><span class="nx">s</span> <span class="nx">Service</span><span class="p">)</span> <span class="nx">endpoint</span><span class="p">.</span><span class="nx">Endpoint</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">request</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">response</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">req</span> <span class="o">:=</span> <span class="nx">request</span><span class="p">.(</span><span class="nx">countRequest</span><span class="p">)</span>
		<span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nf">Count</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">Categories</span><span class="p">)</span>
		<span class="k">return</span> <span class="nx">countResponse</span><span class="p">{</span><span class="nx">N</span><span class="p">:</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">Err</span><span class="p">:</span> <span class="nx">err</span><span class="p">},</span> <span class="nx">err</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>All of this complexity is removed in the Micronaut version thanks to Micronaut Data into a simple repository declaration:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@JdbcRepository</span><span class="o">(</span><span class="n">dialect</span> <span class="o">=</span> <span class="n">Dialect</span><span class="o">.</span><span class="na">ORACLE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductRepository</span> <span class="kd">extends</span> <span class="n">PageableRepository</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="o">...</span>

    <span class="kt">int</span> <span class="nf">countDistinct</span><span class="o">();</span>

    <span class="kt">int</span> <span class="nf">countDistinctByCategoriesNameInList</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div><p>The SQL queries are automatically implemented at compilation time based on the conventions in the repository interface using the <a href="https://martinfowler.com/eaaCatalog/repository.html">repository pattern</a>.</p>
<p>The endpoint can then just use the repository to easily expose the necessary data over HTTP:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Get</span><span class="o">(</span><span class="s">&#34;/catalogue/size{?categories}&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">CatalogueSizeDTO</span> <span class="nf">size</span><span class="o">(</span><span class="nd">@QueryValue</span> <span class="nd">@Nullable</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">categories</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">categories</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">CatalogueSizeDTO</span><span class="o">(</span><span class="n">productRepository</span><span class="o">.</span><span class="na">countDistinct</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">CatalogueSizeDTO</span><span class="o">(</span><span class="n">productRepository</span><span class="o">.</span><span class="na">countDistinctByCategoriesNameInList</span><span class="o">(</span><span class="n">categories</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>The code is even more complex for listing records instead of performing a count, with Go manual pagination of records is implemented to combine with the already complex SQL concatenation logic:</p>
<div class="highlight"><pre class="chroma"><code class="language-golang" data-lang="golang"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">catalogueService</span><span class="p">)</span> <span class="nf">List</span><span class="p">(</span><span class="nx">categories</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">order</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">pageNum</span><span class="p">,</span> <span class="nx">pageSize</span> <span class="kt">int</span><span class="p">)</span> <span class="p">([]</span><span class="nx">Product</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">products</span> <span class="p">[]</span><span class="nx">Product</span>
	<span class="nx">query</span> <span class="o">:=</span> <span class="nx">baseQuery</span>

	<span class="kd">var</span> <span class="nx">args</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>

	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">t</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">categories</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
			<span class="nx">query</span> <span class="o">+=</span> <span class="s">&#34; WHERE categories.name=:categoryname&#34;</span>
			<span class="nx">args</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">query</span> <span class="o">+=</span> <span class="s">&#34; OR categories.name=:categoryname&#34;</span>
			<span class="nx">args</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">order</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
		<span class="nx">query</span> <span class="o">+=</span> <span class="s">&#34; ORDER BY :orderby&#34;</span>
		<span class="nx">args</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">order</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">products</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">s</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">&#34;database error&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">[]</span><span class="nx">Product</span><span class="p">{},</span> <span class="nx">ErrDBConnection</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">s</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">products</span> <span class="p">{</span>
		<span class="nx">products</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">ImageURL</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="nx">s</span><span class="p">.</span><span class="nx">ImageURL1</span><span class="p">,</span> <span class="nx">s</span><span class="p">.</span><span class="nx">ImageURL2</span><span class="p">}</span>
		<span class="nx">products</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">Categories</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">CategoryString</span><span class="p">,</span> <span class="s">&#34;,&#34;</span><span class="p">)</span>
	<span class="p">}</span>


	<span class="nx">products</span> <span class="p">=</span> <span class="nf">cut</span><span class="p">(</span><span class="nx">products</span><span class="p">,</span> <span class="nx">pageNum</span><span class="p">,</span> <span class="nx">pageSize</span><span class="p">)</span>

	<span class="k">return</span> <span class="nx">products</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">cut</span><span class="p">(</span><span class="nx">products</span> <span class="p">[]</span><span class="nx">Product</span><span class="p">,</span> <span class="nx">pageNum</span><span class="p">,</span> <span class="nx">pageSize</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="nx">Product</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">pageNum</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">pageSize</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="k">return</span> <span class="p">[]</span><span class="nx">Product</span><span class="p">{}</span> <span class="c1">// pageNum is 1-indexed
</span><span class="c1"></span>	<span class="p">}</span>
	<span class="nx">start</span> <span class="o">:=</span> <span class="p">(</span><span class="nx">pageNum</span> <span class="o">*</span> <span class="nx">pageSize</span><span class="p">)</span> <span class="o">-</span> <span class="nx">pageSize</span>
	<span class="k">if</span> <span class="nx">start</span> <span class="p">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">products</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="p">[]</span><span class="nx">Product</span><span class="p">{}</span>
	<span class="p">}</span>
	<span class="nx">end</span> <span class="o">:=</span> <span class="p">(</span><span class="nx">pageNum</span> <span class="o">*</span> <span class="nx">pageSize</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">end</span> <span class="p">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">products</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">end</span> <span class="p">=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">products</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">products</span><span class="p">[</span><span class="nx">start</span><span class="p">:</span><span class="nx">end</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div><p>All of this is unnecessary in the Micronaut version as Micronaut Data has the built in ability to bind pagination parameters from the request and perform pagination on data retrieved from the database:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Get</span><span class="o">(</span><span class="s">&#34;/catalogue{?categories}&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">CatalogueItemDTO</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span>
        <span class="nd">@Nullable</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">,</span>
        <span class="nd">@Nullable</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Stream</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">productStream</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">pageable</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">pageable</span> <span class="o">==</span> <span class="n">Pageable</span><span class="o">.</span><span class="na">UNPAGED</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productStream</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">().</span><span class="na">stream</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">productStream</span> <span class="o">=</span> <span class="n">productRepository</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">pageable</span><span class="o">).</span><span class="na">stream</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">productStream</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">toDTO</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="n">CatalogueItemDTO</span> <span class="nf">toDTO</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">CatalogueItemDTO</span><span class="o">(</span>
            <span class="n">product</span><span class="o">.</span><span class="na">getSku</span><span class="o">(),</span>
            <span class="n">product</span><span class="o">.</span><span class="na">getBrand</span><span class="o">(),</span>
            <span class="n">product</span><span class="o">.</span><span class="na">getTitle</span><span class="o">(),</span>
            <span class="n">product</span><span class="o">.</span><span class="na">getDescription</span><span class="o">(),</span>
            <span class="n">product</span><span class="o">.</span><span class="na">getWeight</span><span class="o">(),</span>
            <span class="n">product</span><span class="o">.</span><span class="na">getProductSize</span><span class="o">(),</span>
            <span class="n">product</span><span class="o">.</span><span class="na">getColors</span><span class="o">(),</span>
            <span class="n">product</span><span class="o">.</span><span class="na">getQuantity</span><span class="o">(),</span>
            <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">(),</span>
            <span class="n">getImageUrl</span><span class="o">(</span><span class="n">product</span><span class="o">),</span>
            <span class="n">getCategories</span><span class="o">(</span><span class="n">product</span><span class="o">)</span>
    <span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>The Micronaut Data version is in fact more flexible as you can customize the default pagination parameter names and sizes through simple configuration in <code>application.yml</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">micronaut</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">data</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">pageable</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">default-page-size</span><span class="p">:</span><span class="w"> </span>-<span class="m">1</span><span class="w">
</span><span class="w">      </span><span class="k">sort-parameter-name</span><span class="p">:</span><span class="w"> </span>sort<span class="w">
</span><span class="w">      </span><span class="k">page-parameter-name</span><span class="p">:</span><span class="w"> </span>page<span class="w">
</span><span class="w">      </span><span class="k">size-parameter-name</span><span class="p">:</span><span class="w"> </span>size<span class="w">
</span></code></pre></div><p>For example changing the <code>page-parameter-sort</code> setting allows you to change the name of the HTTP request parameter used in the query string from client requests to alter how data is sorted.</p>


            </main>
          </div> 
        </div> 
      </div> 
    </div> 
    
<footer class="uk-position-fixed uk-position-bottom">
  <div class="uk-grid">
    
    
    <div class="uk-width-1-1 uk-width-1-3@s uk-width-1-4@m uk-width-1-5@l uk-width-1-6@xl uk-visible@s"></div>
    <div class="uk-width-expand">
      <div>
      
      
      
      


  
    
    
  

  
  
  
    
  

  
  
    


  
    
      
      
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  


  
    


  
    
    
  

  
  
  

  
  
    


  
    
      
      
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
    
  

  
  
  

  
  


  
    


  
    
      
      
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  
    


  
    
  

  
  
  

  
  


  


  


        <div class="uk-flex uk-flex-between uk-margin-top">
          <a href="../../micronaut/atp/" title="Connecting Autonomous Database" class="rw-page-prev uk-flex-first uk-flex uk-flex-left uk-flex-middle uk-text-truncate">
            <span uk-icon="icon: chevron-left; ratio: 2.5" class="uk-margin-small-right uk-flex-none"></span>
            <label class="uk-visible@m">Connecting Autonomous Database</label>
          </a><span></span>
          <a href="../../micronaut/openapi/" title="OpenAPI / Swagger" class="rw-page-next uk-flex-last uk-flex uk-flex-right uk-flex-middle uk-flex-last uk-text-truncate">
            <label class="uk-visible@m">OpenAPI / Swagger</label>
            <span uk-icon="icon: chevron-right; ratio: 2.5" class="uk-margin-small-left uk-flex-none"></span>
          </a></div>
      </div>
    </div>
  </div>
</footer>


    <script type="text/javascript">
  (function(w, s) {
    Object.assign(s, {
      BaseURL: '',
      RelURL: '\/',
      cssConfig: {
        table: 'uk-table uk-table-small uk-table-striped',
        '#TableOfContents > ul': 'uk-nav uk-nav-default uk-nav-parent-icon',
        '#TableOfContents > ul ul': 'uk-nav-sub',
      },
      uikit: {
        '#TableOfContents > ul': ['scrollspyNav', { closest: 'li', offset: 10 }],
        
      }
    });
  })(window, window.Site = window.Site || {});
</script>

<script src="../../js/vendor.min.e005c93e1a94928260d72859a61ad84fa0324ea594a8fb4318c00381a451a8c3.js" ></script><script src="../../js/extras.min.88dc65673919eb6e8151f4f309d54cecb7ba304c48d378ff4d9b858b6b1d2742.js"  async></script><script src="../../js/site.min.d7973f1560bba2270850ebebf4e3a2a2e58e84e1f993191030325ddaef76a81c.js"  async></script>
  </body>
</html>